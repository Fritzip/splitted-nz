{% load leaflet_tags %}
{% load geojson_tags %}
{% load staticfiles %}

{% leaflet_css %}
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
<!-- <link rel="stylesheet" href="{% static 'external/leaflet-extra-markers/css/leaflet.extra-markers.min.css' %}"> -->
<link rel="stylesheet" href="{% static 'site.css' %}" type="text/css" />

{% leaflet_js %}
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js' defer></script>
 <script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>
<!-- <script src="{% static 'external/leaflet-extra-markers/js/leaflet.extra-markers.min.js' %}"></script> -->


<script type="text/javascript">
    function map_init(map, options) {  
        map.addControl(new L.Control.Fullscreen());

        var lcontrollayers = L.control.layers(null, null);
        var tracks = {{ tracks | safe }};

        for (let encoded of tracks ) {
          var coordinates = L.Polyline.fromEncoded(encoded).getLatLngs();

          L.polyline(
              coordinates,
              {
                  color: 'blue',
                  weight: 2,
                  opacity: .7,
                  lineJoin: 'round'
              }
          ).addTo(map);
        }

        // (new L.Control.ResetView(locateBounds)).addTo(map);

        var outdoor = L.tileLayer('https://tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=868563c2a5a94440bbad18257a5d9bc1');
        var classic = L.tileLayer(' https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'); 
        
        lcontrollayers.addBaseLayer(classic,"OSM");
        lcontrollayers.addBaseLayer(outdoor,"Outdoor");

        lcontrollayers.addTo(map);
    }
</script>
